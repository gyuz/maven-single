package exercise2;

import java.io.*;
import java.util.*;
import org.apache.commons.lang3.text.StrBuilder;

public class FileData{
	private File originalFilePath, dummyFilePath;

	FileData(String filePath){
		originalFilePath = new File(filePath);
		dummyFilePath = new File(filePath.substring(0, filePath.lastIndexOf("/"))+"dummyFile.tmp");
	}

	protected void writeToFile(Map<String, String> tableFormatMap, Map<String, String> dataMap){
		try{		
			FileWriter outFile = new FileWriter(originalFilePath);
			BufferedWriter writer = new BufferedWriter(outFile);
			StrBuilder strBuilder = new StrBuilder();
		
			String previousKey = "X";
			for (Map.Entry<String, String> entry : tableFormatMap.entrySet()){
				if(previousKey.equals("X") || previousKey.equals(entry.getKey().substring(0,1))){
					strBuilder.append("("+getNewString(entry.getValue())+","+getNewString(dataMap.get(entry.getValue()))+")");
				}
				else{
					strBuilder.appendNewLine();
					strBuilder.append("("+getNewString(entry.getValue())+","+getNewString(dataMap.get(entry.getValue()))+")");
				}	
				previousKey=entry.getKey().substring(0,1);
			}
			
			writer.write(strBuilder.toString());
			writer.close();
			
			//boolean fileDeleted = originalFilePath.delete(), renameFile = dummyFilePath.renameTo(originalFilePath);
			//fileDeleted = dummyFilePath.delete();		

			
		}
		catch(IOException ie){
			System.out.println("Error writing to file");
		}	
		
	}

	protected String getNewString(String data){
		String newData = "";
		for(int i=0; i<data.length(); i++){
			if(data.charAt(i) == '(' || data.charAt(i) == ')' || data.charAt(i) == ','){
				for(int j=0; j<3; j++){
					newData += data.charAt(i);				
				}
			} else {
				newData += data.charAt(i);			
			}		
		}
		return newData;
	}	
}
